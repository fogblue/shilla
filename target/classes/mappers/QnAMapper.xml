<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="QnAMapper">
	<resultMap id="qna"
		type="iot5.project.shilla.model.QnA">
		<result property="id" column="id" />
		<result property="ecategory" column="ecategory" />
		<result property="hotelCate" column="hotel_cate" />
		<result property="enqType" column="enq_type" />
		<result property="reservNo" column="reserv_no" />
		<result property="weddingDate" column="wedding_date" />
		<result property="qnaType" column="qna_type" />
		<result property="subject" column="subject" />
		<result property="content" column="content" />
		<result property="userNameKor" column="user_name_kor" />
		<result property="email" column="email" />
		<result property="tel" column="tel" />
		<result property="telHome" column="tel_home" />
		<result property="ipAddress" column="ip_address" />
		<result property="regDate" column="reg_date" />
		<result property="editDate" column="edit_date" />
		<result property="memberId" column="member_id" />
	</resultMap>
	
	<!-- 글 갯수 -->
	 <select id="selectQnACount" parameterType="iot5.project.shilla.model.QnA" resultType="int">
        SELECT count(id) FROM qna WHERE member_id=#{memberId}
    </select>
    
     <!-- 글쓰기 -->
	<insert id="insertQnA" parameterType="iot5.project.shilla.model.QnA" 
		useGeneratedKeys="true" keyProperty="id">
		INSERT INTO qna (
			ecategory, hotel_cate, enq_type, reserv_no, wedding_date, qna_type, 
			subject, content, user_name_kor, email, tel, tel_home, ip_address, reg_date, edit_date, member_id
		) VALUES (
			#{ecategory}, #{hotelCate}, #{enqType}, #{reservNo}, #{weddingDate}, #{qnaType}, #{subject},
			#{content}, #{userNameKor}, #{email}, #{tel}, #{telHome}, #{ipAddress}, now(), now(), #{memberId}
		)
	</insert>
	
	<!-- 멤버 삭제를 위한 참조키 제거 -->
	<update id="updateQnAMemberOut" parameterType="iot5.project.shilla.model.QnA">
		UPDATE qna SET member_id=NULL, edit_date=now()
		WHERE member_id=#{memberId}
	</update>
</mapper>